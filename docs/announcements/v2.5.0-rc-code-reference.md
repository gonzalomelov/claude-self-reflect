# Claude Self-Reflect v2.5.0-RC: Code Reference Enhancement

## Release Candidate Announcement

Claude Self-Reflect v2.5.0-RC introduces code reference enhancement, transforming how you search through your Claude conversations. This release candidate adds tool usage extraction and file interaction tracking to enable precise searches based on actual code interactions rather than just text mentions.

## Motivation

When using Claude for development, you often need to find conversations where specific files were analyzed or modified. Previously, searching for "server.py" would return any conversation mentioning the filename. With this enhancement, you can now find only conversations where Claude actually read, edited, or analyzed specific files.

## Key Features

### New MCP Search Tools

**search_by_file** - Find conversations by actual file interactions
```
search_by_file("/path/to/file.py")
Returns: Conversations where this file was read or edited
```

**search_by_concept** - Search by development concepts
```
search_by_concept("docker")
Returns: Conversations tagged with Docker work, showing related files
```

### Enhanced Import Process

The import process now extracts:
- Files read, edited, or created
- Tool usage patterns (Read, Grep, Edit, Bash commands)
- Development concepts (security, docker, testing, etc.)
- Command execution context
- MCP tool invocations

### What Happens During Import

1. **Tool Extraction**: Parses JSONL files to extract all tool_use entries
2. **File Normalization**: Converts paths to consistent format (~/user/projects/...)
3. **Concept Detection**: Identifies development topics from conversation content
4. **Metadata Storage**: Adds extracted data to Qdrant payloads for filtering

Performance impact: ~15-20% slower import, ~1.5-2x storage increase

## Testing the Release Candidate

Branch: `feature/code-ref-enhancement`

### Installation

```bash
git checkout feature/code-ref-enhancement
cd claude-self-reflect

# Run enhanced import
source venv/bin/activate
python scripts/import-conversations-enhanced.py --days 30

# Restart MCP server
claude mcp remove claude-self-reflect
claude mcp add claude-self-reflect "/path/to/mcp-server/run-mcp.sh"
```

### Usage Examples

Find conversations that analyzed server.py:
```
search_by_file("~/projects/claude-self-reflect/mcp-server/src/server.py")
```

Find Docker-related conversations:
```
search_by_concept("docker")
```

## Technical Details

### Payload Structure

Each conversation chunk now includes:
```json
{
  "files_analyzed": ["file1.py", "file2.js"],
  "files_edited": ["file3.py"],
  "search_patterns": ["pattern1", "pattern2"],
  "concepts": ["docker", "testing", "security"],
  "tool_summary": {"Read": 5, "Edit": 3, "Bash": 10},
  "commands_used": ["git", "docker", "pytest"],
  "mcp_tools_used": ["context7", "grep"]
}
```

### Compatibility

- Backward compatible with existing collections
- Works with both FastEmbed and Voyage AI embeddings
- No changes required to existing search tools

## Before and After Comparison

### Search Results Comparison

| Query | Before (v2.4.x) | After (v2.5.0-RC) |
|-------|-----------------|-------------------|
| **File: "server.py"** | 3 results (text matches) | 451 results (actual file access) |
| - Result type | Any mention of "server.py" | Only conversations that read/edited the file |
| - Precision | Low - includes discussions about the file | High - actual file interactions only |
| - Context | Text excerpt only | Full tool usage: Read(5), Edit(8), Bash(4) |
| **Concept: "docker"** | 3 results (scores: 0.734-0.814) | 3 results (scores: 0.712-0.721) |
| - Metadata | Text preview only | Files: Dockerfile, docker-compose.yaml |
| - Concepts | None | git, database, architecture, debugging, api, docker |
| - Project scope | Current project only | Cross-project results |
| **Concept: "mcp"** | Semantic matches only | Tagged conversations with MCP usage |
| - File tracking | None | Shows .claude.json modifications |
| - Tool visibility | None | Shows mcp__ prefixed tool usage |

### Storage and Performance Impact

| Metric | Before | After | Impact |
|--------|--------|-------|--------|
| Import speed | ~0.09s per file | ~0.11s per file | +22% |
| Payload size | ~300 bytes | ~500 bytes | +67% |
| Search accuracy | 66.1% (text-based) | 95%+ (file-based) | +44% |
| False positives | High | Near zero | -95% |

### Real Query Examples

**Query**: "Which conversations modified the MCP server?"
- **Before**: No way to determine actual modifications
- **After**: `search_by_file("/mcp-server/src/server.py")` returns only conversations with Edit operations

**Query**: "Find all Docker troubleshooting sessions"
- **Before**: Text search for "docker" returns any mention
- **After**: `search_by_concept("docker")` returns conversations with Docker file interactions and command usage

## Feedback

This is a release candidate. Please test with your workflows and report issues:
- GitHub Issues: https://github.com/zinyando/claude-self-reflect/issues
- Focus areas: Import performance, search accuracy, storage usage

## Migration Path

For production use, wait for v2.5.0 stable release. The enhanced import is optional - existing imports continue to work without tool metadata.