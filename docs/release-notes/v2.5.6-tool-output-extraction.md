# Release Notes - v2.5.6

## ðŸŽ¯ Tool Output Extraction Enhancement

**Release Date**: August 11, 2025  
**Type**: Feature Enhancement  
**Priority**: High - Enables discovery of other agents' work

## Overview

Claude Self-Reflect now captures and indexes tool outputs, making git file changes and command results searchable. This critical enhancement allows you to find conversations based on what files were modified, not just what was discussed.

## What's New

### Tool Output Extraction (Metadata v2)
- **Captures tool outputs**: First 500 characters of each tool output preserved
- **Git file detection**: Automatically extracts file paths from git diff/show/status outputs
- **Searchable modifications**: Files mentioned in git commands become searchable
- **Cross-agent discovery**: Find work done by other Claude agents via file changes

### Enhanced Search Capabilities
- `search_by_file`: Now finds conversations with git-modified files
- `search_by_concept`: Improved concept detection including git operations
- Tool outputs included in semantic search index

## Technical Changes

### Metadata Schema v2
```python
{
    "metadata_version": 2,  # Upgraded from v1
    "git_file_changes": [],  # NEW: Files from git outputs
    "tool_outputs": [],      # NEW: Tool output previews
    # ... existing fields preserved
}
```

### Files Modified
- `scripts/streaming-importer.py`: Added tool output extraction
- `scripts/import-conversations-unified.py`: Added tool output extraction
- `scripts/delta-metadata-update.py`: Can upgrade existing points to v2

### New Functions
- `extract_files_from_git_output()`: Parses git command outputs
- Two-pass JSONL parsing: Collects outputs then matches with tool uses

## Impact

### Before
- Only tool inputs were captured
- Git file changes weren't searchable
- Other agents' work was hard to discover

### After
- Tool outputs preserved (up to 15 per conversation)
- Git file changes extracted (up to 20 files)
- Cross-agent work discoverable via file searches

## Examples

### Finding Git-Modified Files
```python
# Search for conversations that modified a specific file
search_by_file(file_path="README.md")
# Returns conversations where README.md was in git diff/status/show output

# Search for git-related work
search_by_concept(concept="git")
# Returns conversations with git operations
```

### What Gets Captured
When you run `git show --stat`:
```
README.md         | 58 ++++++++
enhance.md        | 219 ++++++++++++----
enhance-old.md    | 379 ----------------
4 files changed, 162 insertions(+), 453 deletions(-)
```

The system now extracts:
- Files: README.md, enhance.md, enhance-old.md
- Tool output preview (first 500 chars)
- Makes these files searchable

## Migration

### For Existing Users
1. **Automatic**: Streaming importer handles new conversations
2. **Manual Re-import**: For historical data with tool outputs
   ```bash
   docker compose run --rm importer
   ```
3. **Delta Update**: Add metadata without re-importing
   ```bash
   python scripts/delta-metadata-update.py
   ```

### Docker Users
```bash
# Rebuild containers with new code
docker compose down
docker compose build
docker compose --profile mcp up -d
```

## Breaking Changes
None - Backward compatible with v1 metadata

## Known Limitations
- Tool outputs limited to 500 characters per output
- Maximum 15 tool outputs per conversation
- Maximum 20 git file changes per conversation
- Only extracts from specific git commands (diff, show, status)

## Performance
- Minimal overhead: ~10ms per conversation
- No impact on search speed
- Storage increase: ~2-5KB per conversation with tool outputs

## Testing
Verified with:
- 15 tool outputs successfully extracted
- 6 git file changes detected in test conversation
- 275+ conversations found via file search
- Cross-agent discovery confirmed

## Credits
This enhancement was developed to enable cross-agent collaboration and make all Claude agent work discoverable through the self-reflect system.